---
/**
 * Homepage
 */
import Base from '../layouts/Base.astro';
import EverydayCard from '../components/EverydayCard.astro';
import { getEverydayPosts, getWorkPosts, getBlogPosts, getMediaUrl } from '../lib/api';

// Fetch content for each section
const [everydayData, workPosts, blogData] = await Promise.all([
  getEverydayPosts(1, 6),
  getWorkPosts(),
  getBlogPosts(1, 1),
]);

const recentEveryday = everydayData.posts;
const featuredWork = workPosts.slice(0, 3);
const latestPost = blogData.posts[0];
const latestPostImage = latestPost ? await getMediaUrl(latestPost.featured_media) : null;
---

<Base title="Home">

  {/* Hero */}
  <section class="p-8 md:p-16 text-center">
    <h1 class="text-yellow-500 text-5xl md:text-7xl font-bold mb-4">29F_</h1>
    <p class="text-teal-500 text-lg md:text-xl max-w-xl mx-auto">
      Creative work by Daniel McFarland. Motion graphics, 3D, and digital art.
    </p>
  </section>

  {/* Recent Everyday */}
  <section class="p-4 md:p-8">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-yellow-500 text-2xl font-bold">#EVERYDAY</h2>
      <a href="/everyday" class="text-teal-600 hover:text-yellow-500 transition-colors">View all &rarr;</a>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
      {recentEveryday.map((post) => (
        <EverydayCard post={post} />
      ))}
    </div>
  </section>

  {/* Featured Work */}
  <section class="p-4 md:p-8">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-yellow-500 text-2xl font-bold">Work</h2>
      <a href="/work" class="text-teal-600 hover:text-yellow-500 transition-colors">View all &rarr;</a>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      {featuredWork.map((post) => {
        const thumbnail = post.toolset_fields.work_images?.[0];
        const title = post.title.rendered.replace(/<[^>]*>/g, '');
        return (
          <a href={`/work/${post.slug}`} class="group block border border-teal-800 hover:border-teal-500 transition-colors">
            {thumbnail && (
              <img src={thumbnail} alt={title} class="w-full aspect-video object-cover" loading="lazy" />
            )}
            <div class="p-4">
              <h3 class="text-yellow-500 font-bold group-hover:text-white transition-colors">{title}</h3>
            </div>
          </a>
        );
      })}
    </div>
  </section>

  {/* Latest Blog Post */}
  {latestPost && (
    <section class="p-4 md:p-8">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-yellow-500 text-2xl font-bold">Blog</h2>
        <a href="/blog" class="text-teal-600 hover:text-yellow-500 transition-colors">View all &rarr;</a>
      </div>
      <a href={`/blog/${latestPost.slug}`} class="group block border border-teal-800 hover:border-teal-500 transition-colors md:flex">
        {latestPostImage && (
          <img src={latestPostImage} alt="" class="w-full md:w-64 h-48 object-cover" loading="lazy" />
        )}
        <div class="p-4">
          <h3 class="text-yellow-500 text-xl font-bold group-hover:text-white transition-colors">
            {latestPost.title.rendered.replace(/<[^>]*>/g, '')}
          </h3>
          <p class="text-teal-500 mt-2 line-clamp-2">
            {latestPost.excerpt.rendered.replace(/<[^>]*>/g, '').trim()}
          </p>
        </div>
      </a>
    </section>
  )}

  {/* About */}
  <section class="p-4 md:p-8 max-w-3xl mx-auto text-center">
    <h2 class="text-yellow-500 text-2xl font-bold mb-4">About</h2>
    <p class="text-teal-500">
      Motion designer and 3D artist creating animations, visual effects, and digital art.
    </p>
  </section>

  <script src="/js/components/gif-hover.js" type="module"></script>
</Base>
