---
/**
 * Blog Archive Page
 *
 * Displays a list of blog posts with excerpts.
 */
import Base from '../../layouts/Base.astro';
import { getBlogPosts, getMediaUrl } from '../../lib/api';
import { decodeEntities } from '../../lib/utils';

const { posts, total } = await getBlogPosts(1, 20);

// Fetch featured images for all posts
const postsWithImages = await Promise.all(
  posts.map(async (post) => ({
    ...post,
    featuredImage: await getMediaUrl(post.featured_media),
  }))
);
---

<Base title="Blog" description="Thoughts and updates">
  <section class="max-w-4xl mx-auto p-4 md:p-8">
    {/* Page header */}
    <header class="mb-12">
      <h1 class="text-yellow-500 text-4xl md:text-5xl font-bold">Blog</h1>
    </header>

    {/* Post list */}
    <div class="space-y-12">
      {postsWithImages.map((post) => {
        const title = decodeEntities(post.title.rendered.replace(/<[^>]*>/g, ''));
        const excerpt = decodeEntities(post.excerpt.rendered.replace(/<[^>]*>/g, '').trim());
        const formattedDate = new Date(post.date).toLocaleDateString('en-US', {
          month: 'long',
          day: 'numeric',
          year: 'numeric'
        });

        return (
          <article>
            <a href={`/blog/${post.slug}`} class="group grid md:grid-cols-[200px_1fr] gap-6">
              {post.featuredImage ? (
                <img
                  src={post.featuredImage}
                  alt={title}
                  class="w-full md:w-[200px] h-[150px] object-cover"
                  loading="lazy"
                />
              ) : (
                <div class="hidden md:block w-[200px] h-[150px] bg-teal-900" />
              )}
              <div>
                <h2 class="text-yellow-500 text-2xl md:text-3xl font-bold group-hover:text-white transition-colors">
                  {title}
                </h2>
                <time class="text-teal-600 text-sm mt-2 block" datetime={post.date}>{formattedDate}</time>
                {excerpt && (
                  <p class="text-teal-500 mt-3 line-clamp-2">{excerpt}</p>
                )}
              </div>
            </a>
          </article>
        );
      })}
    </div>
  </section>
</Base>
