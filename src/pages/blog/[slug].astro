---
/**
 * Single Blog Post Page
 */
import Base from '../../layouts/Base.astro';
import { getBlogBySlug, getAllBlogSlugs, getMediaUrl } from '../../lib/api';

// Generate static pages for all blog posts
export async function getStaticPaths() {
  const slugs = await getAllBlogSlugs();

  return slugs.map((slug) => ({
    params: { slug },
  }));
}

const { slug } = Astro.params;
const post = await getBlogBySlug(slug!);

if (!post) {
  return Astro.redirect('/404');
}

const title = post.title.rendered.replace(/<[^>]*>/g, '');
const featuredImage = await getMediaUrl(post.featured_media);
const formattedDate = new Date(post.date).toLocaleDateString('en-US', {
  weekday: 'long',
  month: 'long',
  day: 'numeric',
  year: 'numeric'
});
---

<Base title={title} description={post.excerpt.rendered.replace(/<[^>]*>/g, '').trim()}>
  <article class="max-w-3xl mx-auto p-4">

    {/* Header */}
    <header class="mb-6">
      <a href="/blog" class="text-teal-600 hover:text-teal-500 text-sm mb-2 inline-block">
        &larr; Back to Blog
      </a>
      <h1 class="text-yellow-500 text-2xl md:text-4xl font-bold">{title}</h1>
      <time class="text-teal-600 text-sm mt-2 block" datetime={post.date}>{formattedDate}</time>
    </header>

    {/* Featured Image */}
    {featuredImage && (
      <img
        src={featuredImage}
        alt={title}
        class="w-full mb-8"
      />
    )}

    {/* Content */}
    <div
      class="prose prose-lg prose-invert max-w-none
             prose-p:text-teal-400
             prose-headings:text-yellow-500
             prose-a:text-teal-500 hover:prose-a:text-yellow-500
             prose-strong:text-teal-300
             prose-blockquote:border-teal-600 prose-blockquote:text-teal-500
             prose-img:my-8"
      set:html={post.content.rendered}
    />

  </article>
</Base>
